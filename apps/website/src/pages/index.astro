---
import { getCollection } from "astro:content";
import type { ProjectSchema } from "@content/config";

const shownProjects = await getCollection(
  "projects",
  ({ data }: { data: ProjectSchema }) => data.show !== "hidden"
);

const sortedProjects = shownProjects.toSorted((a, b) => {
  if (a.data.year > b.data.year) {
    return -1;
  } else if (b.data.year > a.data.year) {
    return 1;
  } else {
    return 0;
  }
});

import Layout from "@layouts/Layout.astro";
import { Link } from "@components/Link";
import { Dialog } from "@components/Dialog";

import { Icon } from "@components/Icon";
import { IconLink } from "@components/IconLink";
import { IconButton } from "@components/IconButton";
import { Slideshow } from "@components/Slideshow";
import { AgeCode } from "@components/AgeCode";

const AGE_PUBLIC_KEY =
  "age1uguwhdrla2ae2uvvty5zlvg4nnjr86rf50a5rw63fn99dagsj3xs9cgq2n";
---

<Layout>
  <section class="br">
    <hgroup>
      <h1>Roni Tuohino</h1>
      <p>Fullstack Developer</p>
    </hgroup>

    <p>I love building software and going climbing</p>

    <ul class="links">
      <li>
        <Dialog frame={false} client:only contain>
          <Icon slot="button" icon="note" />
          <Slideshow
            client:only
            images={[
              {
                src: "/book.png",
                alt: "Top book Ørnfjord with rock climbers in the background.",
                width: 601,
                height: 798,
              },
              {
                src: "/writing.png",
                alt: "Open book with the text 'Hiton siisti mesta!' from Satu, Roni, Antton, and Perttu.",
                width: 605,
                height: 798,
              },
            ]}
          />
        </Dialog>
      </li>
      <li>
        <Dialog client:only>
          <Icon slot="button" icon="key" />
          <p class="age-encryption">
            To send me secure mail, please use <Link
              href="https://github.com/FiloSottile/age">age</Link
            > with the following public key

            <AgeCode client:only code={AGE_PUBLIC_KEY} />

            <Link href={`https://age-online.com/?r=${AGE_PUBLIC_KEY}`}>
              This tool
            </Link> is handy for quick encryption.
          </p>
        </Dialog>
      </li>
      <li>
        <Dialog client:only>
          <Icon slot="button" icon="ruler" />
          <div class="project-wrapper">
            <table>
              <thead>
                <tr>
                  <th class="year-header">Year</th>
                  <th class="proj-header">Project</th>
                  <th class="org-header">Made at</th>
                  <th class="tech-header">Built with</th>
                </tr>
              </thead>
              <tbody>
                {
                  sortedProjects.map((project) => (
                    <tr>
                      <td class="year">{project.data.year}</td>
                      <td class="proj">
                        <Link href={project.data.links[0]}>
                          {project.data.title}
                        </Link>
                        {project.data.show === "featured" ? (
                          <span class="proj-star">★</span>
                        ) : null}
                      </td>
                      <td class="org">{project.data.organization}</td>
                      <td class="tech">
                        {project.data.technologies.join(", ")}
                      </td>
                    </tr>
                  ))
                }
              </tbody>
            </table>
          </div>
        </Dialog>
      </li>

      <li>
        <IconLink
          link={{
            ariaLabel: "See my GitHub profile",
            href: "https://github.com/ronituohino",
          }}
          icon={{
            icon: "github",
          }}
        />
      </li>
      <li>
        <IconLink
          link={{
            ariaLabel: "See my Linkedin profile",
            href: "https://www.linkedin.com/in/ronituohino/",
          }}
          icon={{
            icon: "linkedin",
          }}
        />
      </li>
      <li>
        <IconLink
          link={{
            ariaLabel: "Send me an email",
            href: "mailto:rt@ronituohino.com",
          }}
          icon={{
            icon: "email",
          }}
        />
      </li>

      <li>
        <IconLink
          link={{
            ariaLabel: "Download résumé (CV)",
            href: "/ronituohino-resume.pdf",
          }}
          icon={{
            icon: "cv",
          }}
        />
      </li>
    </ul>
  </section>
</Layout>

<style>
  hgroup > h1,
  hgroup > p,
  section > p {
    filter: drop-shadow(0px 0px 6px hsl(0, 0%, 25%));
  }

  .br {
    padding: var(--content-padding);
    position: absolute;
    bottom: 0;
    right: 0;

    text-align: right;
    display: flex;
    flex-direction: column;
    align-items: end;
    justify-content: end;
    gap: 1rem;

    max-width: 500px;
  }

  .links {
    display: flex;
    flex-direction: row;
    gap: 0.25rem;
    flex-wrap: wrap;
    justify-content: end;
  }

  .age-encryption {
    margin: 0.5rem;
    text-align: center;
  }

  .project-wrapper {
    overflow: hidden;
    display: flex;
    justify-content: center;
  }

  table {
    border-collapse: collapse;
    max-width: 1600px;
  }
  thead {
    text-align: left;
  }
  tbody {
    text-align: left;
  }

  thead > tr,
  tbody > tr:not(:last-child) {
    border-bottom: 3px solid rgb(255, 187, 109);
  }

  th,
  td {
    padding: 0.25rem 0.5rem;
  }

  .year-header,
  .year {
    width: 1rem;
    padding-left: 0;
  }
  .proj {
    word-break: break-word;
  }
  .proj-star {
    color: rgb(255, 137, 3);
  }
  .org {
    display: none;
  }
  .org-header {
    display: none;
  }
  .tech-header {
    display: none;
  }
  .tech {
    display: none;
  }
  @media screen and (min-width: 496px) {
    .proj {
      word-break: normal;
    }
    .org-header {
      display: table-cell;
    }
    .org {
      display: table-cell;
    }
  }
  @media screen and (min-width: 900px) {
    .tech-header {
      display: table-cell;
    }
    .tech {
      display: table-cell;
    }
  }
  @media screen and (min-width: 768px) {
    .year-header,
    .year {
      width: 2rem;
    }
  }
</style>
